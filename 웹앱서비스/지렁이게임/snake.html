<center>스네이크 게임을 웹 앱으로 만들어줘!
<div id="snake-game">
  <h1>스네이크 게임</h1>
  <p>스네이크 게임은 정해진 공간에서 먹이를 먹으며 점수를 얻는 게임입니다.</p>
  <p>게임을 시작하면 뱀의 머리가 화면 상에 나타나며, 방향키를 이용하여 뱀을 이동시킬 수 있습니다.</p>
  <p>뱀의 머리가 먹이에 닿으면 먹이를 먹으며, 먹이를 먹을 때마다 점수가 올라갑니다.</p>
  <p>뱀이 벽이나 자기 자신과 부딪히면 게임이 종료됩니다.</p>
</div>

<div id="toast">Snake game!</div>
 <canvas id="canvas" width="550" height="450" style="background-image: url('https://media.tenor.com/Hdja_JngSjIAAAAC/worm-crown.gif'); background-repeat: no-repeat; background-size: 100% 100%;"></canvas>
 <div style="background-color: blue; color: white; padding: 10px; display: flex; justify-content: space-between;">
    <span>High Score: <span id="highscore">0</span></span>
    <span>Score: <span id="score">0</span></span>
    <button id="start" style="background-color: white; color: blue; font-weight: bold; padding: 10px 20px; border-radius: 5px; cursor: pointer; ">Start</button>
<button id="stop" style="background-color: lightcoral; color: white; font-weight: bold; padding: 10px 20px; border-radius: 5px; cursor: pointer;" disabled>Stop</button>
  </div>

</center>



<script>

// highscore 값을 가져오는 함수
function getHighScore() {
  return localStorage.getItem('highScore');
}

// 게임 페이지가 로드될 때, highscore 값을 가져옵니다.
window.onload = function() {
  var highscore = getHighScore();

  // highscore 값이 존재한다면, 화면에 출력합니다.
  if (highscore !== null) {
    document.getElementById('highscore').innerHTML = highscore;
  }
}

  const canvas = document.querySelector('#canvas');
    const ctx = canvas.getContext('2d');
    const scoreElem = document.querySelector('#score');
    const highScoreElem = document.querySelector('#highscore');
    const startBtn = document.querySelector('#start');
    const stopBtn = document.querySelector('#stop');
    let intervalId;
    let isPlaying = false;
    let score = 0;
    let highScore = localStorage.getItem('highScore') || 0;
    let snake = [{ x: 10, y: 10, dx: 1, dy: 0 }, { x: 9, y: 10, dx: 1, dy: 0 }, { x: 8, y: 10, dx: 1, dy: 0 }];
    let food = null;
    const WIDTH = canvas.width / 10;
    const HEIGHT = canvas.height / 10;

const toast = document.getElementById('toast');

function showToast(message, duration) {
  toast.innerText = message;
  toast.style.opacity = 1;
  setTimeout(() => {
    toast.style.opacity = 0;
  }, duration);
}

    function drawCanvas() {
      ctx.fillStyle = 'white';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawSnake() {
      ctx.fillStyle = 'green';
      snake.forEach((cell, index) => {
        if (index === 0) {
          ctx.fillStyle = 'yellow'; // 머리 부분은 노란색으로
        }
        ctx.fillRect(cell.x * 10, cell.y * 10, 10, 10);
        ctx.fillStyle = 'green'; // 다시 초록색으로
      });
    }

    function drawFood() {
      ctx.fillStyle = 'red';
      ctx.fillRect(food.x * 10, food.y * 10, 10, 10);
    }

    function gameLoop() {
       // 이동
      const head = snake[0];
      const newX = head.x + head.dx;
      const newY = head.y + head.dy;
      const collision = snake.some(cell => cell.x === newX && cell.y === newY);
      if (collision || newX < 0 || newX >= WIDTH || newY < 0 || newY >= HEIGHT) {
        // 게임 오버
        clearInterval(intervalId);
        isPlaying = false;
        startBtn.disabled = false;
        stopBtn.disabled = true;
      
        // toast 메시지
        showToast('Oops!', 3000); 

        return;
      }
      snake.unshift({ x: newX, y: newY, dx: head.dx, dy: head.dy });

      // 먹이를 먹었을 때
      if (food && food.x === newX && food.y === newY) {
        score += 1;
        scoreElem.innerText = score;
        highScore = Math.max(highScore, score);
        highScoreElem.textContent = highScore;
        localStorage.setItem('highScore', highScore);

        food = null;
      } else {
        // 먹이를 먹지 않았을 때, 꼬리 부분을 제거합니다.
        snake.pop();
      }

      // 새로운 먹이 생성
      if (food === null) {
        while (true) {
          const x = Math.floor(Math.random() * WIDTH);
          const y = Math.floor(Math.random() * HEIGHT);
          const collision = snake.some(cell => cell.x === x && cell.y === y);
          if (!collision) {
            food = { x, y };
            break;
          }
        }
      }

      // 캔버스 그리기
      drawCanvas();
      drawSnake();
      drawFood();
    }


startBtn.addEventListener('click', () => {
  if (isPlaying) {
    return;
  }
  isPlaying = true;
  score = 0;
  scoreElem.innerText = score;
  snake = [{ x: 10, y: 10, dx: 1, dy: 0 }, { x: 9, y: 10, dx: 1, dy: 0 }, { x: 8, y: 10, dx: 1, dy: 0 }];
  food = null;
  startBtn.disabled = true;
  stopBtn.disabled = false;
  showToast('Start!', 3000);
  intervalId = setInterval(gameLoop, 100);
});

// 게임 중지 버튼 클릭 이벤트
stopBtn.addEventListener('click', () => {
  clearInterval(intervalId);
  isPlaying = false;
  startBtn.disabled = false;
  stopBtn.disabled = true;
  showToast('Stop!', 3000);
});

// 방향키 이벤트
document.addEventListener('keydown', event => {
  if (!isPlaying) {
    return;
  }
  const head = snake[0];
  switch (event.key) {
    case 'ArrowUp':
      if (head.dy !== 1) {
        head.dx = 0;
        head.dy = -1;
      }
      event.preventDefault();
      break;
    case 'ArrowDown':
      if (head.dy !== -1) {
        head.dx = 0;
        head.dy = 1;
      }
      event.preventDefault();
      break;
    case 'ArrowLeft':
      if (head.dx !== 1) {
        head.dx = -1;
        head.dy = 0;
      }
      event.preventDefault();
      break;
    case 'ArrowRight':
      if (head.dx !== -1) {
        head.dx = 1;
        head.dy = 0;
      }
      event.preventDefault();
      break;
  }
});


</script>


<style>
 #canvas {
      border: 1px solid black;
    }
#toast {
  position: absolute;
  top: 35%;
  left: 50%;
  transform: translate(-50%, 50%);
  padding: 16px;
  background-color: #333;
  color: #fff;
  border-radius: 8px;
  opacity: 0;
  transition: opacity 0.3s;
}

#start:hover,
#stop:hover {
  transform: scale(1.25);
  transition: transform 0.3s;
}

#start:active,
#stop:active {
  transform: scale(1);
  transition: transform 0.3s;
}
#snake-game {
  background-color: #fff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
  margin: 20px auto !important;
  max-width: 800px;
  padding: 20px;
  text-align: center;
}

#snake-game h1 {
  font-size: 36px;
  margin: 20px !important;
  text-align: center;
  color: black;
}

#snake-game p {
  font-size: 18px;
  line-height: 1.5;
  margin-bottom: 10px;
  text-align: center;
  color: black !important;
}

#snake-game p:last-child {
  margin-bottom: 0;
}
</style>